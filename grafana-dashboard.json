{
    "__inputs": [
        {
            "name": "DS_PROMETHEUS",
            "label": "Prometheus",
            "description": "",
            "type": "datasource",
            "pluginId": "prometheus",
            "pluginName": "Prometheus"
        }
    ],
    "__requires": [
        { "type": "grafana", "id": "grafana", "name": "Grafana", "version": "8.0.0" },
        { "type": "panel", "id": "stat", "name": "Stat", "version": "" },
        { "type": "panel", "id": "timeseries", "name": "Time series", "version": "" },
        { "type": "datasource", "id": "prometheus", "name": "Prometheus", "version": "1.0.0" },
        { "type": "panel", "id": "barchart", "name": "Bar chart", "version": "" },
        { "type": "panel", "id": "piechart", "name": "Pie chart", "version": "" },
        { "type": "panel", "id": "table", "name": "Table", "version": "" }
    ],
    "annotations": { "list": [ { "builtIn": 1, "datasource": { "type": "grafana", "uid": "-- Grafana --" }, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "target": { "limit": 100, "matchAny": false, "tags": [], "type": "dashboard" }, "type": "dashboard" } ] },
    "editable": true,
    "gnetId": null,
    "graphTooltip": 0,
    "id": null,
    "links": [],
    "panels": [
        { "title": "Resumen General", "type": "row", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 } },
        {
            "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
            "fieldConfig": { "defaults": { "color": { "mode": "thresholds" }, "mappings": [ { "options": { "-1": { "color": "gray", "text": "Unknown" }, "0": { "color": "red", "text": "Failure" }, "1": { "color": "green", "text": "Success" } }, "type": "value" } ], "thresholds": { "mode": "absolute", "steps": [ { "color": "gray", "value": -1 }, { "color": "red", "value": 0 }, { "color": "green", "value": 1 } ] } } },
            "gridPos": { "h": 8, "w": 16, "x": 0, "y": 1 },
            "id": 1,
            "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": [ "lastNotNull" ], "fields": "/^backup_last_status$/", "values": false }, "textMode": "auto" },
            "targets": [ { "expr": "backup_last_status", "legendFormat": "{{database_name}}", "refId": "A" } ],
            "title": "Estado del último backup por BD",
            "type": "table"
        },
        {
            "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
            "fieldConfig": { "defaults": { "color": { "mode": "thresholds" }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null } ] } } },
            "gridPos": { "h": 4, "w": 8, "x": 16, "y": 1 },
            "id": 2,
            "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": [ "lastNotNull" ], "fields": "", "values": false }, "textMode": "auto" },
            "targets": [ { "expr": "sum(backups_total)", "legendFormat": "Total", "refId": "A" } ],
            "title": "Total de backups existentes",
            "type": "stat"
        },
        {
            "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
            "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "align": "auto", "displayMode": "auto" }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null } ] } } },
            "gridPos": { "h": 4, "w": 8, "x": 16, "y": 5 },
            "id": 3,
            "options": { "footer": { "countRows": false, "fields": "", "reducer": [ "sum" ], "show": false }, "showHeader": true },
            "targets": [ { "expr": "sum(backups_total) by (database_name)", "format": "table", "instant": true, "legendFormat": "", "refId": "A" } ],
            "title": "Total de backups por BD",
            "type": "table"
        },
        { "title": "Almacenamiento y API", "type": "row", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 9 } },
        {
            "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
            "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "pieType": "pie", "displayLabels": ["percent", "name"] }, "mappings": [], "unit": "bytes" } },
            "gridPos": { "h": 8, "w": 8, "x": 0, "y": 10 },
            "id": 4,
            "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "reduceOptions": { "calcs": [ "lastNotNull" ], "fields": "", "values": true }, "tooltip": { "mode": "single" } },
            "targets": [ { "expr": "disk_space_used_bytes", "legendFormat": "Used", "refId": "A" }, { "expr": "disk_space_available_bytes", "legendFormat": "Available", "refId": "B" } ],
            "title": "Uso de espacio en disco",
            "type": "piechart"
        },
        {
            "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
            "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "align": "auto", "displayMode": "auto" }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null } ] } } },
            "gridPos": { "h": 8, "w": 8, "x": 8, "y": 10 },
            "id": 5,
            "options": { "footer": { "countRows": false, "fields": "", "reducer": [ "sum" ], "show": false }, "showHeader": true },
            "targets": [ { "expr": "sort_desc(sum(rate(http_requests_total[5m])) by (handler))", "format": "table", "instant": true, "legendFormat": "", "refId": "A" } ],
            "title": "Endpoints más usados (5m)",
            "type": "table"
        },
        {
            "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
            "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "align": "auto", "displayMode": "auto" }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null } ] } } },
            "gridPos": { "h": 8, "w": 8, "x": 16, "y": 10 },
            "id": 6,
            "options": { "footer": { "countRows": false, "fields": "", "reducer": [ "sum" ], "show": false }, "showHeader": true },
            "targets": [ { "expr": "sort_desc(sum(rate(http_requests_total{code=~\"5..\"}[5m])) by (handler))", "format": "table", "instant": true, "legendFormat": "", "refId": "A" } ],
            "title": "Endpoints con más errores (5m)",
            "type": "table"
        }
    ],
    "schemaVersion": 36,
    "style": "dark",
    "tags": [],
    "templating": { "list": [] },
    "time": { "from": "now-7d", "to": "now" },
    "timepicker": {},
    "timezone": "browser",
    "title": "Backup Monitoring - Enhanced",
    "uid": null,
    "version": 5
}
